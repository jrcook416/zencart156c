From 354b9524197fffb79eef238e8f98138014e82f2c Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 09:07:34 -0700
Subject: [PATCH] Adding .gitignore to minion/includes/.gitignore

---
 minion/includes/.gitignore | 1 +
 1 file changed, 1 insertion(+)
 create mode 100644 minion/includes/.gitignore

diff --git a/minion/includes/.gitignore b/minion/includes/.gitignore
new file mode 100644
index 0000000..9b5edfe
--- /dev/null
+++ b/minion/includes/.gitignore
@@ -0,0 +1 @@
+configure.php
-- 
1.9.5.msysgit.0

From 7f1ad9826bc69008b72e782651d6839c114bb168 Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 09:07:00 -0700
Subject: [PATCH] Ignoring minion/includes/configure.php

---
 minion/includes/configure.php | 93 -------------------------------------------
 1 file changed, 93 deletions(-)
 delete mode 100644 minion/includes/configure.php

diff --git a/minion/includes/configure.php b/minion/includes/configure.php
deleted file mode 100644
index 379ef87..0000000
--- a/minion/includes/configure.php
+++ /dev/null
@@ -1,93 +0,0 @@
-<?php
-/**
- * @package Configuration Settings
- * @copyright Copyright 2003-2018 Zen Cart Development Team
- * @copyright Portions Copyright 2003 osCommerce
- * @license http://www.zen-cart.com/license/2_0.txt GNU Public License V2.0
- * File Built by Zen Cart Installer on Tue Sep 10 2019 11:33:27
- */
-
-
-/*************** NOTE: This file is VERY similar to, but DIFFERENT from the "store" version of configure.php. ***********/
-/***************       The 2 files should be kept separate and not used to overwrite each other.              ***********/
-
-/**
- * Enter the domain for your Admin URL. If you have SSL, enter the correct https address in the HTTP_SERVER setting, instead of just an http address.
- */
-define('HTTP_SERVER', 'https://www.iemssupply.net');
-/**
- * Note about HTTPS_SERVER:
- * There is no longer an HTTPS_SERVER setting for the Admin. Instead, put your SSL URL in the HTTP_SERVER setting above.
- */
-
-/**
- * Note about DIR_WS_ADMIN
- * The DIR_WS_ADMIN value is now auto-detected.
- * In the rare case where it cannot be detected properly, you can add your own DIR_WS_ADMIN definition below.
- */
-
-/**
- * Enter the domain for your storefront URL.
- * Enter a separate SSL URL in HTTPS_CATALOG_SERVER if your store supports SSL.
- */
-define('HTTP_CATALOG_SERVER', 'http://www.iemssupply.net');
-define('HTTPS_CATALOG_SERVER', 'https://www.iemssupply.net');
-
-/**
- * Do you use SSL for your customers login/checkout on the storefront? If so, enter 'true'. Else 'false'.
- */
-define('ENABLE_SSL_CATALOG', 'true');
-
-/**
- * These DIR_WS_xxxx values refer to the name of any subdirectory in which your store is located.
- * These values get added to the HTTP_CATALOG_SERVER and HTTPS_CATALOG_SERVER values to form the complete URLs to your storefront.
- * They should always start and end with a slash ... ie: '/' or '/foldername/'
- */
-define('DIR_WS_CATALOG', '/zencart156c/');
-define('DIR_WS_HTTPS_CATALOG', '/zencart156c/');
-
-/**
- * This is the complete physical path to your store's files.  eg: /var/www/vhost/accountname/public_html/store/
- * Should have a closing / on it.
- */
-define('DIR_FS_CATALOG', '/home/g445kxms4qgi/public_html/zencart156c/');
-
-/**
- * NOTE about DIR_FS_ADMIN
- * The value for DIR_FS_ADMIN is now auto-detected.
- * In the very rare case where there is a need to override the autodetection, simply add your own definition for it below.
- */
-
-/**
- * The following settings define your database connection.
- * These must be the SAME as you're using in your non-admin copy of configure.php
- */
-define('DB_TYPE', 'mysql'); // always 'mysql'
-define('DB_PREFIX', ''); // prefix for database table names -- preferred to be left empty
-define('DB_CHARSET', 'utf8mb4'); // 'utf8mb4' or older 'utf8' / 'latin1' are most common
-define('DB_SERVER', 'localhost');  // address of your db server
-define('DB_SERVER_USERNAME', 'zencart156c');
-define('DB_SERVER_PASSWORD', 'iEMS!1311131');
-define('DB_DATABASE', 'zencart156c');
-
-/**
- * This is an advanced setting to determine whether you want to cache SQL queries.
- * Options are 'none' (which is the default) and 'file' and 'database'.
- */
-define('SQL_CACHE_METHOD', 'none');
-
-/**
- * Reserved for future use
- */
-define('SESSION_STORAGE', 'reserved for future use');
-
-/**
- * Advanced use only:
- * The following are OPTIONAL, and should NOT be set unless you intend to change their normal use. Most sites will leave these untouched.
- * To use them, uncomment AND add a proper defined value to them.
- */
-// define('DIR_FS_SQL_CACHE' ...
-// define('DIR_FS_DOWNLOAD' ...
-// define('DIR_FS_LOGS' ...
-
-// End Of File
-- 
1.9.5.msysgit.0

From 1123921ba04232554d00c6572efa73c32001d96b Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 08:52:40 -0700
Subject: [PATCH] Trying to ignore configure.php again.

---
 includes/configure.php | 72 --------------------------------------------------
 1 file changed, 72 deletions(-)
 delete mode 100644 includes/configure.php

diff --git a/includes/configure.php b/includes/configure.php
deleted file mode 100644
index cd8c823..0000000
--- a/includes/configure.php
+++ /dev/null
@@ -1,72 +0,0 @@
-<?php
-/**
- * @package Configuration Settings
- * @copyright Copyright 2003-2018 Zen Cart Development Team
- * @copyright Portions Copyright 2003 osCommerce
- * @license http://www.zen-cart.com/license/2_0.txt GNU Public License V2.0
- * File Built by Zen Cart Installer on Tue Sep 10 2019 11:33:27
- */
-
-/*************** NOTE: This file is VERY similar to, but DIFFERENT from the "admin" version of configure.php. ***********/
-/***************       The 2 files should be kept separate and not used to overwrite each other.              ***********/
-
-/**
- * Enter the domain for your store
- * HTTP_SERVER is your Main webserver: eg-http://www.yourdomain.com
- * HTTPS_SERVER is your Secure/SSL webserver: eg-https://www.yourdomain.com
- */
-define('HTTP_SERVER', 'http://www.iemssupply.net');
-define('HTTPS_SERVER', 'https://www.iemssupply.net');
-
-/**
- *  If you want to tell Zen Cart to use your HTTPS URL on sensitive pages like login and checkout, set this to 'true'. Otherwise 'false'. (Keep the quotes)
- */
-define('ENABLE_SSL', 'true');
-
-/**
- * These DIR_WS_xxxx values refer to the name of any subdirectory in which your store is located.
- * These values get added to the HTTP_CATALOG_SERVER and HTTPS_CATALOG_SERVER values to form the complete URLs to your storefront.
- * They should always start and end with a slash ... ie: '/' or '/foldername/'
- */
-define('DIR_WS_CATALOG', '/zencart156c/');
-define('DIR_WS_HTTPS_CATALOG', '/zencart156c/');
-
-/**
- * This is the complete physical path to your store's files.  eg: /var/www/vhost/accountname/public_html/store/
- * Should have a closing / on it.
- */
-define('DIR_FS_CATALOG', '/home/g445kxms4qgi/public_html/zencart156c/');
-
-/**
- * The following settings define your database connection.
- * These must be the SAME as you're using in your admin copy of configure.php
- */
-define('DB_TYPE', 'mysql'); // always 'mysql'
-define('DB_PREFIX', ''); // prefix for database table names -- preferred to be left empty
-define('DB_CHARSET', 'utf8mb4'); // 'utf8mb4' or older 'utf8' / 'latin1' are most common
-define('DB_SERVER', 'localhost');  // address of your db server
-define('DB_SERVER_USERNAME', 'zencart156c');
-define('DB_SERVER_PASSWORD', 'iEMS!1311131');
-define('DB_DATABASE', 'zencart156c');
-
-/**
- * This is an advanced setting to determine whether you want to cache SQL queries.
- * Options are 'none' (which is the default) and 'file' and 'database'.
- */
-define('SQL_CACHE_METHOD', 'none');
-
-/**
- * Reserved for future use
- */
-define('SESSION_STORAGE', 'reserved for future use');
-
-/**
- * Advanced use only:
- * The following are OPTIONAL, and should NOT be set unless you intend to change their normal use. Most sites will leave these untouched.
- * To use them, uncomment AND add a proper defined value to them.
- */
-// define('DIR_FS_SQL_CACHE' ...
-// define('DIR_FS_DOWNLOAD' ...
-// define('DIR_FS_LOGS' ...
-
-// End Of File
-- 
1.9.5.msysgit.0

From d2f6be128d6888a87f0fd017046553cfead6686c Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 08:51:00 -0700
Subject: [PATCH] Ignoring configure.php

---
 includes/.gitignore    |  1 +
 includes/configure.php | 72 ++++++++++++++++++++++++++++++++++++++++++++++++++
 2 files changed, 73 insertions(+)
 create mode 100644 includes/.gitignore
 create mode 100644 includes/configure.php

diff --git a/includes/.gitignore b/includes/.gitignore
new file mode 100644
index 0000000..9b5edfe
--- /dev/null
+++ b/includes/.gitignore
@@ -0,0 +1 @@
+configure.php
diff --git a/includes/configure.php b/includes/configure.php
new file mode 100644
index 0000000..cd8c823
--- /dev/null
+++ b/includes/configure.php
@@ -0,0 +1,72 @@
+<?php
+/**
+ * @package Configuration Settings
+ * @copyright Copyright 2003-2018 Zen Cart Development Team
+ * @copyright Portions Copyright 2003 osCommerce
+ * @license http://www.zen-cart.com/license/2_0.txt GNU Public License V2.0
+ * File Built by Zen Cart Installer on Tue Sep 10 2019 11:33:27
+ */
+
+/*************** NOTE: This file is VERY similar to, but DIFFERENT from the "admin" version of configure.php. ***********/
+/***************       The 2 files should be kept separate and not used to overwrite each other.              ***********/
+
+/**
+ * Enter the domain for your store
+ * HTTP_SERVER is your Main webserver: eg-http://www.yourdomain.com
+ * HTTPS_SERVER is your Secure/SSL webserver: eg-https://www.yourdomain.com
+ */
+define('HTTP_SERVER', 'http://www.iemssupply.net');
+define('HTTPS_SERVER', 'https://www.iemssupply.net');
+
+/**
+ *  If you want to tell Zen Cart to use your HTTPS URL on sensitive pages like login and checkout, set this to 'true'. Otherwise 'false'. (Keep the quotes)
+ */
+define('ENABLE_SSL', 'true');
+
+/**
+ * These DIR_WS_xxxx values refer to the name of any subdirectory in which your store is located.
+ * These values get added to the HTTP_CATALOG_SERVER and HTTPS_CATALOG_SERVER values to form the complete URLs to your storefront.
+ * They should always start and end with a slash ... ie: '/' or '/foldername/'
+ */
+define('DIR_WS_CATALOG', '/zencart156c/');
+define('DIR_WS_HTTPS_CATALOG', '/zencart156c/');
+
+/**
+ * This is the complete physical path to your store's files.  eg: /var/www/vhost/accountname/public_html/store/
+ * Should have a closing / on it.
+ */
+define('DIR_FS_CATALOG', '/home/g445kxms4qgi/public_html/zencart156c/');
+
+/**
+ * The following settings define your database connection.
+ * These must be the SAME as you're using in your admin copy of configure.php
+ */
+define('DB_TYPE', 'mysql'); // always 'mysql'
+define('DB_PREFIX', ''); // prefix for database table names -- preferred to be left empty
+define('DB_CHARSET', 'utf8mb4'); // 'utf8mb4' or older 'utf8' / 'latin1' are most common
+define('DB_SERVER', 'localhost');  // address of your db server
+define('DB_SERVER_USERNAME', 'zencart156c');
+define('DB_SERVER_PASSWORD', 'iEMS!1311131');
+define('DB_DATABASE', 'zencart156c');
+
+/**
+ * This is an advanced setting to determine whether you want to cache SQL queries.
+ * Options are 'none' (which is the default) and 'file' and 'database'.
+ */
+define('SQL_CACHE_METHOD', 'none');
+
+/**
+ * Reserved for future use
+ */
+define('SESSION_STORAGE', 'reserved for future use');
+
+/**
+ * Advanced use only:
+ * The following are OPTIONAL, and should NOT be set unless you intend to change their normal use. Most sites will leave these untouched.
+ * To use them, uncomment AND add a proper defined value to them.
+ */
+// define('DIR_FS_SQL_CACHE' ...
+// define('DIR_FS_DOWNLOAD' ...
+// define('DIR_FS_LOGS' ...
+
+// End Of File
-- 
1.9.5.msysgit.0

From be249021c4d17f6803c6b87ab21fb4842fde6f85 Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 08:41:30 -0700
Subject: [PATCH] Ignoring configure.php

---
 includes/configure.php | 72 --------------------------------------------------
 1 file changed, 72 deletions(-)
 delete mode 100644 includes/configure.php

diff --git a/includes/configure.php b/includes/configure.php
deleted file mode 100644
index cd8c823..0000000
--- a/includes/configure.php
+++ /dev/null
@@ -1,72 +0,0 @@
-<?php
-/**
- * @package Configuration Settings
- * @copyright Copyright 2003-2018 Zen Cart Development Team
- * @copyright Portions Copyright 2003 osCommerce
- * @license http://www.zen-cart.com/license/2_0.txt GNU Public License V2.0
- * File Built by Zen Cart Installer on Tue Sep 10 2019 11:33:27
- */
-
-/*************** NOTE: This file is VERY similar to, but DIFFERENT from the "admin" version of configure.php. ***********/
-/***************       The 2 files should be kept separate and not used to overwrite each other.              ***********/
-
-/**
- * Enter the domain for your store
- * HTTP_SERVER is your Main webserver: eg-http://www.yourdomain.com
- * HTTPS_SERVER is your Secure/SSL webserver: eg-https://www.yourdomain.com
- */
-define('HTTP_SERVER', 'http://www.iemssupply.net');
-define('HTTPS_SERVER', 'https://www.iemssupply.net');
-
-/**
- *  If you want to tell Zen Cart to use your HTTPS URL on sensitive pages like login and checkout, set this to 'true'. Otherwise 'false'. (Keep the quotes)
- */
-define('ENABLE_SSL', 'true');
-
-/**
- * These DIR_WS_xxxx values refer to the name of any subdirectory in which your store is located.
- * These values get added to the HTTP_CATALOG_SERVER and HTTPS_CATALOG_SERVER values to form the complete URLs to your storefront.
- * They should always start and end with a slash ... ie: '/' or '/foldername/'
- */
-define('DIR_WS_CATALOG', '/zencart156c/');
-define('DIR_WS_HTTPS_CATALOG', '/zencart156c/');
-
-/**
- * This is the complete physical path to your store's files.  eg: /var/www/vhost/accountname/public_html/store/
- * Should have a closing / on it.
- */
-define('DIR_FS_CATALOG', '/home/g445kxms4qgi/public_html/zencart156c/');
-
-/**
- * The following settings define your database connection.
- * These must be the SAME as you're using in your admin copy of configure.php
- */
-define('DB_TYPE', 'mysql'); // always 'mysql'
-define('DB_PREFIX', ''); // prefix for database table names -- preferred to be left empty
-define('DB_CHARSET', 'utf8mb4'); // 'utf8mb4' or older 'utf8' / 'latin1' are most common
-define('DB_SERVER', 'localhost');  // address of your db server
-define('DB_SERVER_USERNAME', 'zencart156c');
-define('DB_SERVER_PASSWORD', 'iEMS!1311131');
-define('DB_DATABASE', 'zencart156c');
-
-/**
- * This is an advanced setting to determine whether you want to cache SQL queries.
- * Options are 'none' (which is the default) and 'file' and 'database'.
- */
-define('SQL_CACHE_METHOD', 'none');
-
-/**
- * Reserved for future use
- */
-define('SESSION_STORAGE', 'reserved for future use');
-
-/**
- * Advanced use only:
- * The following are OPTIONAL, and should NOT be set unless you intend to change their normal use. Most sites will leave these untouched.
- * To use them, uncomment AND add a proper defined value to them.
- */
-// define('DIR_FS_SQL_CACHE' ...
-// define('DIR_FS_DOWNLOAD' ...
-// define('DIR_FS_LOGS' ...
-
-// End Of File
-- 
1.9.5.msysgit.0

From 113106470ab6a61310fd48dfc64d63554875a838 Mon Sep 17 00:00:00 2001
From: Jeremiah Cook <jeremiah.cook@indianapolisems.org>
Date: Thu, 19 Sep 2019 10:31:24 -0400
Subject: [PATCH] Module fixes for shipping and payment modules.

---
 includes/languages/english/modules/payment/cod.php |   4 +-
 .../english/modules/payment/freecharger.php        |   2 +-
 .../english/modules/shipping/freeoptions.php       |  14 +-
 .../english/modules/shipping/storepickup.php       |   6 +-
 minion/includes/extra_configures/ot_edit.php       |   3 +
 minion/includes/languages/english/ot_edit.php      |  11 ++
 minion/ot_edit.php                                 | 174 +++++++++++++++++++++
 7 files changed, 197 insertions(+), 17 deletions(-)
 create mode 100644 minion/includes/extra_configures/ot_edit.php
 create mode 100644 minion/includes/languages/english/ot_edit.php
 create mode 100644 minion/ot_edit.php

diff --git a/includes/languages/english/modules/payment/cod.php b/includes/languages/english/modules/payment/cod.php
index e855cc3..950ce4c 100644
--- a/includes/languages/english/modules/payment/cod.php
+++ b/includes/languages/english/modules/payment/cod.php
@@ -20,6 +20,6 @@
 // $Id: cod.php 1969 2005-09-13 06:57:21Z drbyte $
 //
 
-  define('MODULE_PAYMENT_COD_TEXT_TITLE', 'Cash on Delivery');
-  define('MODULE_PAYMENT_COD_TEXT_DESCRIPTION', 'Cash on Delivery');
+  define('MODULE_PAYMENT_COD_TEXT_TITLE', 'Invoice Billing Direct to Agency');
+  define('MODULE_PAYMENT_COD_TEXT_DESCRIPTION', 'Invoice Billing Direct to Agency');
 ?>
\ No newline at end of file
diff --git a/includes/languages/english/modules/payment/freecharger.php b/includes/languages/english/modules/payment/freecharger.php
index 1b1fe50..656acef 100644
--- a/includes/languages/english/modules/payment/freecharger.php
+++ b/includes/languages/english/modules/payment/freecharger.php
@@ -7,5 +7,5 @@
  */
 
   define('MODULE_PAYMENT_FREECHARGER_TEXT_TITLE', 'Free Order');
-  define('MODULE_PAYMENT_FREECHARGER_TEXT_DESCRIPTION', 'There is no charge for this order. Typically used for granting Free Shipping. Required to allow no-charge checkouts. Required for free downloads.');
+  define('MODULE_PAYMENT_FREECHARGER_TEXT_DESCRIPTION', 'Free Order.');
   define('MODULE_PAYMENT_FREECHARGER_TEXT_EMAIL_FOOTER', 'There is no charge for this order.');
diff --git a/includes/languages/english/modules/shipping/freeoptions.php b/includes/languages/english/modules/shipping/freeoptions.php
index bc72aa1..46e252d 100644
--- a/includes/languages/english/modules/shipping/freeoptions.php
+++ b/includes/languages/english/modules/shipping/freeoptions.php
@@ -7,16 +7,8 @@
  * @version $Id: freeoptions.php 3830 2006-06-21 23:47:16Z ajeh $
  */
 
-define('MODULE_SHIPPING_FREEOPTIONS_TEXT_TITLE', 'Free Shipping Options');
-define('MODULE_SHIPPING_FREEOPTIONS_TEXT_DESCRIPTION', '
-Free Options is used to display a Free Shipping option when other Shipping Modules are displayed.
-It can be based on: Always show, Order Total, Order Weight or Order Item Count.
-The Free Options module does not show when Free Shipper is displayed.<br /><br />
-Setting Total to >= 0.00 and <= nothing (leave blank) will activate this module to show with all shipping modules, except for Free Shipping - freeshipper.<br /><br />
-NOTE: Leaving all settings for Total, Weight and Item count blank will deactivate this module.<br /><br />
-NOTE: Free Shipping Options does not display if Free Shipping is used based on 0 weight is Free Shipping.
-See: freeshipper
-');
-define('MODULE_SHIPPING_FREEOPTIONS_TEXT_WAY', 'Free Shipping');
+define('MODULE_SHIPPING_FREEOPTIONS_TEXT_TITLE', 'Delivery to Marion County Location');
+define('MODULE_SHIPPING_FREEOPTIONS_TEXT_DESCRIPTION', 'Delivery to Marion County Location');
+define('MODULE_SHIPPING_FREEOPTIONS_TEXT_WAY', 'Delivery to Marion County Location');
 
 ?>
\ No newline at end of file
diff --git a/includes/languages/english/modules/shipping/storepickup.php b/includes/languages/english/modules/shipping/storepickup.php
index 8be7aa1..f16a9cd 100644
--- a/includes/languages/english/modules/shipping/storepickup.php
+++ b/includes/languages/english/modules/shipping/storepickup.php
@@ -7,9 +7,9 @@
  * @version GIT: $Id: Author: DrByte  Thu Feb 14 23:03:50 2013 -0500 Modified in v1.5.2 $
  */
 
-define('MODULE_SHIPPING_STOREPICKUP_TEXT_TITLE', 'Store Pickup');
-define('MODULE_SHIPPING_STOREPICKUP_TEXT_DESCRIPTION', 'Customer In Store Pick-up');
-define('MODULE_SHIPPING_STOREPICKUP_TEXT_WAY', 'Walk In');
+define('MODULE_SHIPPING_STOREPICKUP_TEXT_TITLE', 'Pickup at IEMS Logistics Warehouse');
+define('MODULE_SHIPPING_STOREPICKUP_TEXT_DESCRIPTION', 'Pickup at IEMS Logistics Warehouse');
+define('MODULE_SHIPPING_STOREPICKUP_TEXT_WAY', 'Pickup at IEMS Logistics Warehouse');
 
 
 // The following is for defining multiple locations/methods on a per-language basis. It is only used if the shopper has selected a language other than the store's default.
diff --git a/minion/includes/extra_configures/ot_edit.php b/minion/includes/extra_configures/ot_edit.php
new file mode 100644
index 0000000..c2dbc2f
--- /dev/null
+++ b/minion/includes/extra_configures/ot_edit.php
@@ -0,0 +1,3 @@
+<?php 
+define('FILENAME_OT_EDIT', 'ot_edit'); 
+define('TEXT_OT_EDIT', 'Edit Order Totals'); 
diff --git a/minion/includes/languages/english/ot_edit.php b/minion/includes/languages/english/ot_edit.php
new file mode 100644
index 0000000..929d304
--- /dev/null
+++ b/minion/includes/languages/english/ot_edit.php
@@ -0,0 +1,11 @@
+<?php
+define('HEADING_TITLE', 'Order Total Editor');
+define('UPDATED_TOTAL', 'Updated Total: '); 
+define('HEADING_SUB_TITLE', 'Editing Order '); 
+
+// Messages 
+define('ERROR_ORDER_NOT_SPECIFIED', 'Error: You must specify an order number.');
+define('ERROR_ORDER_DOES_NOT_EXIST', 'Error: Order does not exist.');
+define('SUCCESS_ORDER_UPDATED', 'Success: Order has been successfully updated.');
+define('WARNING_ORDER_NOT_UPDATED', 'Warning: Nothing to change. The order was not updated.');
+
diff --git a/minion/ot_edit.php b/minion/ot_edit.php
new file mode 100644
index 0000000..9f48bc8
--- /dev/null
+++ b/minion/ot_edit.php
@@ -0,0 +1,174 @@
+<?php
+/**
+ * @package admin
+ * @copyright Copyright 2019 That Software Guy 
+ * @link https://www.thatsoftwareguy.com/zencart_ot_edit.html 
+ * @copyright Portions Copyright 2003-2019 Zen Cart Development Team
+ * @copyright Portions Copyright 2003 osCommerce
+ * @license http://www.zen-cart.com/license/2_0.txt GNU Public License V2.0
+ */
+require('includes/application_top.php');
+
+// unset variable which is sometimes tainted by bad plugins like magneticOne tools
+if (isset($module)) {
+  unset($module);
+}
+
+require(DIR_WS_CLASSES . 'currencies.php');
+$currencies = new currencies();
+
+if (!isset($_GET['page'])) $_GET['page'] = '';
+$action = (isset($_GET['action']) ? $_GET['action'] : '');
+$oID = FALSE;
+if (isset($_POST['oID'])) {
+  $oID = zen_db_prepare_input(trim($_POST['oID']));
+} elseif (isset($_GET['oID'])) {
+  $oID = zen_db_prepare_input(trim($_GET['oID']));
+}
+if (!$oID) {
+    $messageStack->add_session(ERROR_ORDER_NOT_SPECIFIED, 'error');
+    zen_redirect(zen_href_link(FILENAME_ORDERS, zen_get_all_get_params(array('oID', 'action')), 'NONSSL'));
+}
+$orders = $db->Execute("SELECT orders_id, currency  
+                          FROM " . TABLE_ORDERS . "
+                          WHERE orders_id = " . (int)$oID);
+$order_exists = true;
+if ($orders->RecordCount() <= 0) {
+    $order_exists = false;
+    if ($action != '') {
+      $messageStack->add_session(ERROR_ORDER_DOES_NOT_EXIST . ' ' . $oID, 'error');
+    }
+    zen_redirect(zen_href_link(FILENAME_ORDERS, zen_get_all_get_params(array('oID', 'action')), 'NONSSL'));
+}
+$order_currency = zen_db_prepare_input($orders->fields['currency']); 
+$currency_query = $db->Execute("SELECT * FROM " . TABLE_CURRENCIES . " WHERE code = '" . $order_currency . "'"); 
+if ($currency_query->EOF) {
+  define("CURR_SYMBOL", "$"); 
+  define("CURR_SEPARATOR", ","); 
+} else {
+  define("CURR_SYMBOL", $currency_query->fields['symbol_left']); 
+  define("CURR_SEPARATOR", $currency_query->fields['thousands_point']); 
+}
+$zco_notifier->notify('NOTIFY_ADMIN_ORDER_PREDISPLAY_HOOK', $oID, $action);
+
+if (zen_not_null($action) && $order_exists == true) {
+  switch ($action) {
+    case 'edit':
+      break;
+    case 'update_order':
+      // Process each post that looks like 'ot_' 
+      $text = zen_db_prepare_input($_POST['ot_subtotal']); 
+      $text = str_replace(CURR_SYMBOL,"",$text); 
+      $text = str_replace(CURR_SEPARATOR,"",$text); 
+      $total =   floatval($text); 
+      foreach ($_POST as $key => $text) {
+        $key = zen_db_prepare_input($key);
+        $text = zen_db_prepare_input($text); 
+        if (strncmp($key, "ot_", 3) !== 0) continue; 
+        if ($key == "ot_subtotal") continue; 
+        if ($key == "ot_total") continue; 
+        $text = str_replace(CURR_SYMBOL,"",$text); 
+        $text = str_replace(CURR_SEPARATOR, "",$text); 
+        $value = floatval($text); 
+        if ($key == "ot_tax") $tax_value = $value; 
+        if (empty($text)) continue;
+        if (strpos("-", $text) !== false) {
+          $total -= $value; 
+        } else {
+          $total += $value; 
+        }
+        $db->Execute("UPDATE " . TABLE_ORDERS_TOTAL . " SET text = '" . $currencies->format($value) . "', value=" . $value . " WHERE orders_id = " . (int)$oID . " AND class = '" . $key . "'");  
+      }
+      // Update total in OT table 
+      $db->Execute("UPDATE " . TABLE_ORDERS_TOTAL . " SET text = '" . $currencies->format($total) . "', value=" . $total. " WHERE orders_id = " . (int)$oID . " AND class = 'ot_total'");  
+      // Update total in ORDERS table 
+      $db->Execute("UPDATE " . TABLE_ORDERS . " SET order_total = " . $total. " WHERE orders_id = " . (int)$oID); 
+      // Update tax in ORDERS table 
+      if (isset($tax_value)) {
+         $db->Execute("UPDATE " . TABLE_ORDERS . " SET order_tax = " . $tax_value . " WHERE orders_id = " . (int)$oID); 
+      }
+      $messageStack->add_session(SUCCESS_ORDER_UPDATED, 'success');
+      zen_record_admin_activity('Order ' . $oID . ' updated.', 'info');
+      zen_redirect(zen_href_link(FILENAME_OT_EDIT, zen_get_all_get_params(array('action')) . 'action=edit', 'NONSSL'));
+      break;
+  }
+}
+?>
+<!doctype html>
+<html <?php echo HTML_PARAMS; ?>>
+  <head>
+    <meta charset="<?php echo CHARSET; ?>">
+    <title><?php echo TITLE; ?></title>
+    <link rel="stylesheet" type="text/css" href="includes/stylesheet.css">
+    <link rel="stylesheet" type="text/css" media="print" href="includes/stylesheet_print.css">
+    <link rel="stylesheet" type="text/css" href="includes/cssjsmenuhover.css" media="all" id="hoverJS">
+    <script src="includes/menu.js"></script>
+    <script src ="includes/general.js"></script>
+    <script>
+      function init() {
+          cssjsmenu('navbar');
+          if (document.getElementById) {
+              var kill = document.getElementById('hoverJS');
+              kill.disabled = true;
+          }
+      }
+    </script>
+  </head>
+  <body onLoad = "init()">
+    <!-- header //-->
+    <?php
+    require(DIR_WS_INCLUDES . 'header.php');
+    ?>
+    <!-- header_eof //-->
+    <!-- body //-->
+<?php
+$totals = $db->Execute("SELECT * FROM " . TABLE_ORDERS_TOTAL . " WHERE orders_id = " . (int)$oID . " ORDER BY sort_order"); 
+?>
+    <div class="container-fluid">
+      <!-- body_text //-->
+      <h1><?php echo HEADING_TITLE; ?></h1>
+      <h4><?php echo HEADING_SUB_TITLE . " " . $oID; ?></h4>
+
+        <div class="row noprint">
+          <div class="formArea">
+              <?php echo zen_draw_form('status', FILENAME_OT_EDIT, zen_get_all_get_params(array('action')) . 'action=update_order', 'post', 'class="form-horizontal"', true); ?>
+<br />
+<?php
+ while (!$totals->EOF) { 
+?>
+            <div class="form-group">
+                <?php echo zen_draw_label($totals->fields['title'], $totals->fields['class'], 'class="col-sm-3 control-label"'); ?>
+              <div class="col-sm-3">
+<?php 
+   if ($totals->fields['class'] == 'ot_subtotal' || 
+       $totals->fields['class'] == 'ot_total') { 
+      echo zen_draw_input_field($totals->fields['class'], $totals->fields['text'], 'class="form-control" readonly'); 
+   } else { 
+      echo zen_draw_input_field($totals->fields['class'], $totals->fields['text'], 'class="form-control"'); 
+   }
+?>
+              </div>
+            </div>
+<?php 
+   $totals->MoveNext(); 
+ } 
+?>
+            <div class="form-group">
+              <div class="col-sm-9 col-sm-offset-3">
+                <button type="submit" class="btn btn-info"><?php echo IMAGE_UPDATE; ?></button>
+              </div>
+            </div>
+            <?php echo '</form>'; ?>
+      <!-- body_text_eof //-->
+
+    </div>
+    <!-- body_eof //-->
+
+    <!-- footer //-->
+    <div class="footer-area">
+      <?php require(DIR_WS_INCLUDES . 'footer.php'); ?>
+    </div>
+    <!-- footer_eof //-->
+  </body>
+</html>
+<?php require(DIR_WS_INCLUDES . 'application_bottom.php'); ?>
-- 
1.9.5.msysgit.0

